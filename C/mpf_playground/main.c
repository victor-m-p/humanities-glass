#include "mpf.h"
// mpf -l [filename]

int main (int argc, char *argv[]) {
	double t0;
	samples *data;
	int i, j;
	
	t0=clock();

	if ((argc == 1) || (argv[1][0] != '-')) {

		printf("Greetings, Professor Falken. Please specify a command-line option.\n");
		
	} else {
		
		data=new_data();
		load_data(argv[2], data);	
		
		init_params(data); // initialize the J_ij and h_i guesses

		sort_and_filter(data); // remove duplicates from the data, create the nearest neighbour list

		// for(i=0;i<data->uniq;i++) {
		// 	for(j=0;j<data->n;j++) {
		// 		printf("%i", data->obs[i][j]);
		// 	}
		// 	printf(" (%i)\n", data->mult[i]);
		// }
		//
		// printf("\n\n");

		// for(i=0;i<data->near_uniq;i++) {
		// 	if (data->near_ok[i] == 0) {
		// 		for(j=0;j<data->n;j++) {
		// 			printf("%i", data->near[i][j]);
		// 		}
		// 		printf(" (%i)\n", data->near_ok[i]);
		// 	}
		// }
		printf("DATA SPACE: %i\n", data->near_uniq);
		
		simple_minimizer(data); // minimize...

		// convert_01(data);
		printf("\n\nFields\n");
		for(i=data->h_offset;i<data->n_params;i++) {
			printf("%lf ", data->big_list[i]);
		}
		printf("\n");

		printf("Pairs\n");
		for(i=0;i<data->h_offset;i++) {
			printf("%lf ", data->big_list[i]); // to match Eddie convention
		}
		printf("\n");
		
		double par[20*20*19/2]={0.13199436777769188,0.22811953165220308,-0.09422369540419114,0.06175315785696464,0.18241579925228235,0.07377468903198732,-0.17245406220571613,0.038385262512935975,0.15105113619444785,-0.23091278411027677,-0.31880009406129056,0.13965841450854344,0.06358072696563877,0.17104189426580815,-0.04849321313117218,-0.24434372721447067,0.13290449356558784,-0.02773466853990739,0.24211111418396739,-0.1176388794190154,-0.05183489905668846,-0.06872969890442045,-0.05015140651776427,-0.04227604928966003,0.009194300436511848,0.10594421654193306,-0.37682428359174497,0.14763347318859257,-0.023392998684839173,0.15196232658180628,-0.24360455174335297,-0.002658095816828266,0.15930041197980074,0.07676713075009076,-0.14420275333639232,0.13684064207389093,0.0045971396677499405,0.01526087601886541,0.1870580782989638,-0.0017825102709751438,0.09546233263575127,-0.19331297232140796,0.15430130603400458,-0.10264425811009906,0.23478772651309782,-0.09244654348936192,-0.024648215677080587,0.023808236175322184,-0.07753636106857896,-0.07129575011329958,0.17170589421805252,-0.049701218119070696,-0.04809976653677896,-0.07862978408638704,-0.11639856973363873,0.12504154930120362,0.1369569427990702,0.20249822397490755,-0.21446434171361173,-0.20141839925660443,0.060231163714113724,0.22827316799680078,-0.11558813338178384,-0.06451834946838537,0.09626343810880707,-0.10805285941612355,-0.10698772763025213,-0.0045738932422075005,0.09006757348467816,0.06697386045587969,-0.1124697717910865,0.062278442728877455,0.09318617500007306,-0.2227416559638454,-0.03865343136079923,0.01937376123280917,0.2568494527630886,-0.01707930293631248,-0.2885956484744497,-0.1839498828467613,0.06311340433755701,-0.11892180438113652,-0.10250469351196649,0.19941139591703017,0.1332401660312655,-0.19683853766531054,0.03007758070233641,-0.03547097063999911,-0.01188340991345176,0.024445296398462466,0.10836979917714758,-0.28822599228904544,0.06720278517748737,0.13759015566069316,0.10240172287520215,0.15218352547752229,-0.1188403457885966,-0.02070994648567785,0.05221416284428984,-0.0898817549078579,-0.03776940205147126,0.03557959151517895,-0.13306733223284076,0.059721689995425924,-0.11243056541182953,-0.05774358460108241,0.06264634552733762,0.2625053675600119,0.18955282764546058,-0.23010588026020876,-0.062239131139881186,0.04445848993191345,0.2543966557127847,0.05443861152144814,0.1208891657640058,-0.25445065653117704,0.11926540265934873,0.0607348153878696,-0.1497156242460563,-0.04855141865969857,0.27083202606121826,-0.2478546368011085,-0.2594400617992141,-0.2877217816166762,-0.04394718843424358,-0.10033509569833683,0.30409202509951555,-0.145127771257931,-0.0926692456993236,-0.13235406386560464,0.05561908110493785,-0.42112537646552367,-0.1629765698826279,0.11253315218297488,0.409761354873349,0.29012155967425773,-0.04264752375270583,0.17639773940463643,-0.07185945401356884,0.04205290205799925,0.05816321482885893,0.2876679417867244,-0.06324982478252084,0.20469330975200722,-0.022085861067917028,0.0711535157716441,-0.03541770227065243,-0.09256924003515551,-0.01048069670327192,-0.2731032005996022,-0.3052933508759507,-0.06534257032531977,-0.10648176646493099,0.09193837333789784,0.12225747204395368,0.13611870478846144,0.06101347593839531,-0.03046104693553696,0.21833623512611336,-0.022463001636561553,-0.22411681316185025,-0.006071953896025829,0.008910867430984426,0.002747047121491323,-0.022654383988442595,0.008392706510142962,-0.19452401246727602,0.03967235789079465,0.025410351472691748,-0.09178403704792487,0.1402789444942465,-0.22350437820072103,-0.1154068740877871,0.2126346288007978,-0.005167053821006575,-0.1471253957737967,-0.06700020186329682,-0.27089236276429024,-0.03277327522385971,-0.0992048650240313,-0.016908973914520762,0.008023693849867234,-0.16605338341627635,-0.05217756190012805,0.23882241173421487,0.1653313795356526,0.303731656672359,0.030877126470457338,-0.2045579400844429,-0.08616386341345406,-0.08473298896699255,-0.06217759992253827,0.06598016941373988,0.03566661202979174,-0.05851248891275859,-0.024109997906032216,-0.0058282180279124116,0.15248364001383796,0.020946554198396694,0.13469758650072472,-0.2805925065476703,0.019466613161696844,-0.17372801578557806,-0.2699696408257837,0.20173234999981537,-0.04549421095997083,-0.11498839559802398,-0.07177862472440144,0.0679829457770044,-0.006602480418329226};
		data->big_list=par;
		compute_k_general(data, 1);
		printf("\n\nEddie solution: %lf\n", data->k);
		printf("Fields\n");
		for(i=data->h_offset;i<data->n_params;i++) {
			printf("%lf ", data->big_list[i]);
		}
		printf("\n");

		printf("Pairs\n");
		for(i=0;i<data->h_offset;i++) {
			printf("%lf ", data->big_list[i]); // to match Eddie convention
		}
		printf("\n");
		
		// delete_data(data);
	}
	exit(1);
}